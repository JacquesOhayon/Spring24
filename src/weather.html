<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Antibiotic Reduction Project</title>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-md arp-custom navbar-dark py-3"><!--for responsive collapsing-->
        <div class="container"> <!--Keeps away content at the same distance from edge of screen regardless of screen size; put all content in a container-->
            <a href="index.html" class="navbar-brand"><strong style="color: white;">Antibiotic Reduction Project</strong></a>
            <!--Toggle Button; appears once screen size reaches breakpoint-->
            <button 
                class="navbar-toggler" 
                type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#navmenu"
                style="color: white;"
                >
                <span class="navbar-toggler-icon"></span>
            </button>
            <!--Navbar Items-->
            <div class="collapse navbar-collapse" id="navmenu"> <!--for grouping and hiding navbar contents by a parent breakpoint.-->
                <ul class="navbar-nav ms-auto"> <!-- ms-auto is automaitc spacing for the start of this list (Keeps content to the right side); and me-auto does the opposite-->
                    <li class="nav-item">
                        <a href="research.html" class="nav-link">Research</a>
                    </li>
                    <li class="nav-item">
                        <a href="weather.html" class="nav-link">Weather Tool</a>
                    </li>
                    <li class="nav-item">
                        <a href="contact.html" class="nav-link">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a href="https://alt-antibiotics.org/Login.php" class="nav-link">Login</a>
                    </li>
                </ul>
            </div>
            
        </div>
    </nav>

    <!--Weather Data Input Form-->
    <section class="p-5 p-lg-0 pt-lg-5 text-start">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between"> 
                <div class="col-md-6" id="weatherFormContainer">
                    <h1 style="color: #4A508A;">Weather Data(VPD)</h1>
                    <p style="color: #4A508A;" class="lead">This weather tool retrieves accurate temperature, humidity, and vapor pressure deficit (VPD) for any selected day at any hour. This information is used to find correlations between extreme behavior in people and the weather.</p>
                    <form id="weatherForm">
                        <div class="mb-3">
                            <label class="form-label">Location</label>
                            <input type="text" placeholder="What city did the event occur?" class="form-control" id="location" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="date" required>
                            <div id="dateHelp" class="form-text">Please enter the date of the event.</div>
                        </div>
                        <button type="submit" class="btn btn-warning mb-5">Submit</button>
                    </form>
                </div>
                <div class="col-md-5">
                    <div id="imageContainer">
                        <img class="img-fluid d-none d-sm-block w-100" src="../assets/img/weather.svg" alt="Medical Research Illustration">
                    </div>
                    <div id="vpdTable"></div>
                </div>
            </div>
        </div>
    </section>
    
    
    <!--Suicide and Weather Correltaions(Section 1)-->
    <section class="p-2 bg-primary text-light">
        <div class="container text-center w-50 p-5">
            <h2>Suicide and Weather Correlations</h2>
            <p class="lead">
                For the graphs below, this weather tool was used to gather weather data for the specific day an 
                individual had committed suicide. The aim of the study is to find any correlations between the 
                vapor pressure deficit and the act of suicide. This tool allows ARP to efficiently investigate 
                events of interest.
            </p>
        </div>
    </section>
    <!--Suicide and Weather Correltaions(Section 2)-->
    <section class="p-5">
        <div class="container">
            <div class="align-items-center justify-content-around">
               <h2 style="color: #4A508A;" class="text-center mb-3">Vapor Pressure Defecit at Time of Death</h2>

                <!--Auto Playing Carousel-->
               <div id="carouselAutoplaying" class="carousel carousel-dark slide w-50 ms-auto me-auto" data-bs-ride="carousel">
                <div class="carousel-inner">
                  <div class="carousel-item active">
                    <img src="../assets/img/Charles Stack.png" class="d-block img-fluid w-100" alt="...">
                  </div>
                  <div class="carousel-item">
                    <img src="../assets/img/K. Nieroda.png" class="d-block img-fluid w-100" alt="...">
                  </div>
                  <div class="carousel-item">
                    <img src="../assets/img/Sara Lee.png" class="d-block img-fluid w-100" alt="...">
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselAutoplaying" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" ></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselAutoplaying" data-bs-slide="next">
                  <span style="color: #4A508A;" class="carousel-control-next-icon" ></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>

             </div>
            </div>
        </div>
    </section>

    <!--Footer-->
    <footer class="p-5 arp-custom text-white text-center position-relative">
        <div class="container">
            <p class="lead">
                Copyright &copy; 2024 Virtual Intelligence LLC
            </p>
            <diV class="position-absolute bottom-0 end-0 p-5">
                <a class="text-light" href="#" role="button">Back to Top</a>
            </diV>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Script to get Visual Crossing information-->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("weatherForm").addEventListener("submit", function(event) {
                event.preventDefault(); // Prevent form submission

                // Get form values
                const location = document.getElementById("location").value;
                const date = document.getElementById("date").value;

                // Validate date
                const currentDate = new Date();
                const selectedDate = new Date(date);

                if (selectedDate >= currentDate) {
                    // Display warning message
                    document.getElementById("dateHelp").textContent = "Please enter a date before today.";
                    return; 
                }

                // Fetch weather data based on user input
                const apiKey = 'ZMC696N3FA8JQW6DRNFUMXE7B';
                const baseUrl = "https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/";
                const fullUrl = `${baseUrl}${location}/${date}/${date}?unitGroup=us&key=${apiKey}`;

                fetch(fullUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(weatherData => {
                        displayWeatherData(weatherData, date);
                    })
                    .catch(error => {
                        console.error('Error fetching weather data:', error);
                    });
            });
        });

        function displayWeatherData(weatherData, date) {
            if (weatherData) {
                console.log(`Weather information for ${weatherData.resolvedAddress}:`);

                // Hide the image container
                const imageContainer = document.getElementById("imageContainer");
                if (imageContainer) {
                    imageContainer.classList.add("d-none");
                }

                // Show the table container
                const tableContainer = document.getElementById("vpdTable");
                if (tableContainer) {
                    tableContainer.classList.remove("d-none");
                }

                // Create table
                if (tableContainer) {
                    tableContainer.innerHTML = `
                        <h2>VPD Results for ${date}</h2>
                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                            <table class="table table-striped table-hover text-center">
                                <thead class="thead-dark">
                                    <tr>
                                        <th scope="col">Time</th>
                                        <th scope="col">VPD in kilo pascals</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                    <!-- Table rows will be populated dynamically here -->
                                </tbody>
                            </table>
                        </div>
                    `;

                    // Populate table with weather data
                    const tableBody = document.getElementById("tableBody");
                    if (tableBody) {
                        weatherData.days.forEach(day => {
                            day.hours.forEach(hour => {
                                console.log(hour)
                                const hourTime = hour.datetime;
                                const temp = hour.temp;
                                const humidity = hour.humidity;
                                

                                // Calculate VPD
                                const vpd = calculateVPD(temp, humidity);

                                // Add row to table
                                const row = document.createElement("tr");
                                row.innerHTML = `
                                    <td>${hourTime}</td>
                                    <td>${vpd.toFixed(2)} kPa</td>
                                `;
                                tableBody.appendChild(row);
                            });
                        });
                    }
                }
            } else {
                console.log("Failed to retrieve weather data");
            }
        }

        function calculateVPD(temperature, humidity) {
            const saturationVaporPressure = 610.78 * Math.exp((temperature * 17.2694) / (temperature + 237.3));
            const vpd = saturationVaporPressure * (1 - humidity / 100);
            return vpd;
        }


    </script>

</body>
</html>
